<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Login - Election 2026</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #0c2461 0%, #1e3799 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.login-container {
    width: 100%;
    max-width: 450px;
}

.login-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 50px 40px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    text-align: center;
    border: 3px solid #d32f2f;
    animation: fadeIn 0.8s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.logo {
    font-size: 3.5rem;
    margin-bottom: 20px;
    background: linear-gradient(135deg, #0c2461 0%, #d32f2f 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

h1 {
    color: #333;
    margin-bottom: 10px;
    font-size: 2.2rem;
}

.subtitle {
    color: #666;
    margin-bottom: 40px;
    font-size: 1.1rem;
    line-height: 1.6;
}

.login-form {
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 25px;
    text-align: left;
}

.form-label {
    display: block;
    color: #333;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 1rem;
}

.form-input {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid #ddd;
    border-radius: 12px;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    background: white;
}

.form-input:focus {
    outline: none;
    border-color: #1976d2;
    box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
}

.form-input.error {
    border-color: #d32f2f;
}

.password-container {
    position: relative;
}

.toggle-password {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 1.2rem;
}

.login-btn {
    width: 100%;
    padding: 18px;
    border: none;
    border-radius: 15px;
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
    color: white;
    margin-top: 10px;
}

.login-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(211, 47, 47, 0.3);
}

.login-btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

.login-btn.loading::after {
    content: " ‚è≥";
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.status-box {
    margin-top: 25px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    border-left: 5px solid #1976d2;
    text-align: left;
    min-height: 80px;
}

.status-title {
    color: #333;
    margin-bottom: 10px;
    font-size: 1.1rem;
    font-weight: 600;
}

#statusMessage {
    color: #666;
    line-height: 1.6;
    font-size: 1rem;
}

.candidates-preview {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 30px 0;
    flex-wrap: wrap;
}

.candidate-tag {
    padding: 8px 15px;
    background: #e8eaf6;
    border-radius: 15px;
    font-size: 0.9rem;
    color: #303f9f;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 5px;
}

.divider {
    display: flex;
    align-items: center;
    margin: 30px 0;
    color: #666;
}

.divider::before, .divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: #ddd;
}

.divider span {
    padding: 0 20px;
    font-size: 0.9rem;
}

.blockchain-section {
    margin-top: 30px;
    padding: 25px;
    background: #e8f5e8;
    border-radius: 15px;
    border: 2px solid #388e3c;
}

.blockchain-title {
    color: #1b5e20;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.connect-btn {
    width: 100%;
    padding: 18px;
    border: none;
    border-radius: 15px;
    font-size: 1.2rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #388e3c 0%, #1b5e20 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
}

.connect-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(56, 142, 60, 0.3);
}

.connect-btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

.footer {
    margin-top: 40px;
    color: #666;
    font-size: 0.9rem;
    text-align: center;
}

.footer a {
    color: #1976d2;
    text-decoration: none;
    font-weight: 600;
}

.footer a:hover {
    text-decoration: underline;
}

.hidden {
    display: none;
}

.success {
    background: #e8f5e8 !important;
    border-left-color: #388e3c !important;
}

.error {
    background: #ffebee !important;
    border-left-color: #d32f2f !important;
}

.warning {
    background: #fff3e0 !important;
    border-left-color: #fbc02d !important;
}

.proceed-btn {
    width: 100%;
    padding: 20px;
    border: none;
    border-radius: 15px;
    font-size: 1.3rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
}

.proceed-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(25, 118, 210, 0.3);
}

.login-info {
    background: #e3f2fd;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    text-align: left;
    font-size: 0.9rem;
    color: #0d47a1;
}

.login-info strong {
    display: block;
    margin-bottom: 5px;
}

@media (max-width: 480px) {
    .login-card {
        padding: 40px 25px;
    }
    
    h1 {
        font-size: 1.8rem;
    }
    
    .form-input {
        padding: 14px 18px;
    }
    
    .login-btn, .connect-btn, .proceed-btn {
        padding: 16px;
        font-size: 1.1rem;
    }
}
</style>
</head>
<body>

<div class="login-container">
    <div class="login-card">
        <div class="logo">üéì</div>
        <h1>Student Election 2026</h1>
        <p class="subtitle">Enter your credentials to access the voting system</p>
        
        <div class="candidates-preview">
            <div class="candidate-tag">üî¥ Akhil Krantikari</div>
            <div class="candidate-tag">üîµ ANNFSU</div>
            <div class="candidate-tag">üü¢ NSU</div>
            <div class="candidate-tag">üü° Independent</div>
        </div>
        
        <div class="login-info">
            <strong>Demo Login Credentials:</strong>
            ‚Ä¢ Username: <strong>student</strong><br>
            ‚Ä¢ Password: <strong>12345</strong>
        </div>
        
        <div class="login-form">
            <div class="form-group">
                <label class="form-label">Username</label>
                <input type="text" id="username" class="form-input" placeholder="Enter your username" autocomplete="username">
            </div>
            
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-container">
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" autocomplete="current-password">
                    <button type="button" class="toggle-password" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
            </div>
            
            <button id="loginBtn" class="login-btn" onclick="login()">
                üîê Login to Voting System
            </button>
        </div>
        
        <div class="status-box">
            <div class="status-title">Login Status</div>
            <div id="statusMessage">
                Enter username: <strong>student</strong> and password: <strong>12345</strong> to continue
            </div>
        </div>
        
        <div class="blockchain-section hidden" id="blockchainSection">
            <div class="blockchain-title">
                üîó Blockchain Wallet Connection
            </div>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.95rem;">
                Now connect your MetaMask wallet to cast your vote on the blockchain
            </p>
            
            <button id="connectBtn" class="connect-btn" onclick="connectWallet()">
                <span>üîó</span>
                <span>Connect MetaMask Wallet</span>
            </button>
        </div>
        
        <button id="proceedBtn" class="proceed-btn hidden" onclick="proceedToVoting()">
            <span>üó≥Ô∏è</span>
            <span>Proceed to Voting Page</span>
        </button>
        
        <div class="footer">
            <p>Powered by Blockchain Technology | Secure & Transparent Voting</p>
            <p><a href="index.html">‚Üê Back to Home</a></p>
        </div>
    </div>
</div>

<script>
// Configuration
const CONFIG = {
    // Login credentials
    VALID_USERNAME: "student",
    VALID_PASSWORD: "12345",
    
    // Blockchain configuration
    NETWORK: {
        chainId: "0x7A69", // 31337
        chainName: "Hardhat Localhost",
        rpcUrl: "http://127.0.0.1:8545/"
    }
};

// State
let loginState = {
    username: "",
    password: "",
    isLoggedIn: false,
    account: null,
    connected: false
};

// DOM Elements
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const connectBtn = document.getElementById('connectBtn');
const proceedBtn = document.getElementById('proceedBtn');
const blockchainSection = document.getElementById('blockchainSection');
const statusMessage = document.getElementById('statusMessage');
const statusBox = document.querySelector('.status-box');

// Toggle password visibility
function togglePassword() {
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    
    // Update button text
    const button = document.querySelector('.toggle-password');
    button.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
}

// Validate login credentials
function login() {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    
    // Basic validation
    if (!username) {
        showError("Please enter your username");
        usernameInput.classList.add('error');
        return;
    }
    
    if (!password) {
        showError("Please enter your password");
        passwordInput.classList.add('error');
        return;
    }
    
    // Show loading
    loginBtn.classList.add('loading');
    loginBtn.disabled = true;
    loginBtn.innerHTML = "üîê Verifying Credentials...";
    
    // Simulate API call delay
    setTimeout(() => {
        // Check credentials
        if (username === CONFIG.VALID_USERNAME && password === CONFIG.VALID_PASSWORD) {
            loginState.isLoggedIn = true;
            loginState.username = username;
            
            // Success
            showSuccess(`‚úÖ Login successful! Welcome, ${username}!`);
            
            // Update UI
            loginBtn.innerHTML = "‚úÖ Login Successful";
            loginBtn.style.background = 'linear-gradient(135deg, #388e3c 0%, #1b5e20 100%)';
            
            // Show blockchain section
            blockchainSection.classList.remove('hidden');
            
            // Auto-focus connect button
            setTimeout(() => {
                connectBtn.focus();
            }, 500);
            
            // Store login state (simple)
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('username', username);
            
        } else {
            // Failed
            showError("‚ùå Invalid username or password. Try: student / 12345");
            usernameInput.classList.add('error');
            passwordInput.classList.add('error');
            
            loginBtn.classList.remove('loading');
            loginBtn.disabled = false;
            loginBtn.innerHTML = "üîê Login to Voting System";
        }
    }, 1500); // 1.5 second delay
}

// Connect to MetaMask wallet
async function connectWallet() {
    if (!window.ethereum) {
        showError("‚ùå MetaMask not detected! Please install MetaMask from metamask.io");
        return;
    }
    
    try {
        // Show loading
        connectBtn.classList.add('loading');
        connectBtn.disabled = true;
        connectBtn.innerHTML = `<span>‚è≥</span><span>Connecting Wallet...</span>`;
        
        // Switch to localhost network
        await switchToLocalhost();
        
        // Request accounts
        const accounts = await window.ethereum.request({
            method: 'eth_requestAccounts'
        });
        
        if (!accounts || accounts.length === 0) {
            throw new Error("No accounts found");
        }
        
        loginState.account = accounts[0];
        loginState.connected = true;
        
        // Update UI
        connectBtn.classList.remove('loading');
        connectBtn.innerHTML = `<span>‚úÖ</span><span>Wallet Connected</span>`;
        connectBtn.style.background = 'linear-gradient(135deg, #1976d2 0%, #0d47a1 100%)';
        
        // Show success
        showSuccess(
            `‚úÖ Wallet connected successfully!<br>
            üë§ Account: ${formatAddress(loginState.account)}<br>
            üéì Student: ${loginState.username}<br>
            üó≥Ô∏è You can now proceed to vote`
        );
        
        // Show proceed button
        proceedBtn.classList.remove('hidden');
        
        // Store wallet info
        sessionStorage.setItem('walletConnected', 'true');
        sessionStorage.setItem('account', loginState.account);
        
    } catch (error) {
        console.error("Connection error:", error);
        
        // Reset button
        connectBtn.classList.remove('loading');
        connectBtn.disabled = false;
        connectBtn.innerHTML = `<span>üîó</span><span>Connect MetaMask Wallet</span>`;
        
        let errorMsg = "Failed to connect to MetaMask.";
        if (error.code === 4001) {
            errorMsg = "‚ùå Connection rejected by user.";
        } else if (error.message.includes("already pending")) {
            errorMsg = "‚ö†Ô∏è Connection request already pending. Please check MetaMask.";
        }
        
        showError(errorMsg);
    }
}

// Switch to localhost network
async function switchToLocalhost() {
    try {
        await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: CONFIG.NETWORK.chainId }]
        });
        return true;
    } catch (switchError) {
        if (switchError.code === 4902) {
            // Network not added, add it
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: CONFIG.NETWORK.chainId,
                        chainName: CONFIG.NETWORK.chainName,
                        rpcUrls: [CONFIG.NETWORK.rpcUrl],
                        nativeCurrency: {
                            name: "ETH",
                            symbol: "ETH",
                            decimals: 18
                        }
                    }]
                });
                return true;
            } catch (addError) {
                console.error("Failed to add network:", addError);
                return false;
            }
        }
        console.error("Failed to switch network:", switchError);
        return false;
    }
}

// Proceed to voting page
function proceedToVoting() {
    if (!loginState.isLoggedIn || !loginState.connected) {
        showError("Please complete both login and wallet connection first");
        return;
    }
    
    // Store final login state
    sessionStorage.setItem('votingReady', 'true');
    
    // Redirect to voting page
    window.location.href = "voting.html";
}

// Format address for display
function formatAddress(address) {
    return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
}

// Show success message
function showSuccess(message) {
    statusMessage.innerHTML = message;
    statusBox.className = "status-box success";
}

// Show error message
function showError(message) {
    statusMessage.innerHTML = message;
    statusBox.className = "status-box error";
}

// Show info message
function showInfo(message) {
    statusMessage.innerHTML = message;
    statusBox.className = "status-box";
}

// Input validation
usernameInput.addEventListener('input', function() {
    this.classList.remove('error');
});

passwordInput.addEventListener('input', function() {
    this.classList.remove('error');
});

// Enter key to login
passwordInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        login();
    }
});

// Check if already logged in on page load
window.addEventListener('load', function() {
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');
    const walletConnected = sessionStorage.getItem('walletConnected');
    
    if (isLoggedIn === 'true') {
        const username = sessionStorage.getItem('username') || 'student';
        loginState.isLoggedIn = true;
        loginState.username = username;
        
        // Auto-fill username
        usernameInput.value = username;
        usernameInput.disabled = true;
        
        // Update UI
        showInfo(`Welcome back, ${username}! Please connect your wallet.`);
        blockchainSection.classList.remove('hidden');
        loginBtn.innerHTML = "‚úÖ Already Logged In";
        loginBtn.disabled = true;
        loginBtn.style.background = 'linear-gradient(135deg, #388e3c 0%, #1b5e20 100%)';
        
        // If wallet already connected
        if (walletConnected === 'true') {
            const account = sessionStorage.getItem('account');
            if (account) {
                loginState.account = account;
                loginState.connected = true;
                
                connectBtn.innerHTML = `<span>‚úÖ</span><span>Wallet Connected</span>`;
                connectBtn.disabled = true;
                connectBtn.style.background = 'linear-gradient(135deg, #1976d2 0%, #0d47a1 100%)';
                
                showSuccess(`‚úÖ Ready to vote! Account: ${formatAddress(account)}`);
                proceedBtn.classList.remove('hidden');
            }
        }
    }
});

// MetaMask event listeners
if (window.ethereum) {
    // Account changed
    window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts && accounts.length > 0) {
            loginState.account = accounts[0];
            loginState.connected = true;
            
            showInfo(`üîÑ Account changed to: ${formatAddress(accounts[0])}`);
            
            // Update session storage
            sessionStorage.setItem('account', accounts[0]);
        } else {
            // User disconnected
            loginState.connected = false;
            proceedBtn.classList.add('hidden');
            showError("üîå Disconnected from wallet. Please reconnect.");
            
            sessionStorage.removeItem('walletConnected');
            sessionStorage.removeItem('account');
            
            connectBtn.innerHTML = `<span>üîó</span><span>Connect MetaMask Wallet</span>`;
            connectBtn.disabled = false;
            connectBtn.style.background = 'linear-gradient(135deg, #388e3c 0%, #1b5e20 100%)';
        }
    });
    
    // Network changed
    window.ethereum.on('chainChanged', () => {
        window.location.reload();
    });
}

// Auto-focus username on page load
window.addEventListener('load', function() {
    if (!loginState.isLoggedIn) {
        usernameInput.focus();
    }
});
</script>
</body>
</html>