<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Student Election 2026</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    text-align: center;
    margin-bottom: 40px;
    padding: 40px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    border: 3px solid #f44336;
}

h1 {
    color: #333;
    margin-bottom: 10px;
    font-size: 2.8rem;
    background: linear-gradient(135deg, #1a237e 0%, #f44336 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.subtitle {
    color: #666;
    font-size: 1.2rem;
}

.admin-badge {
    display: inline-block;
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    color: white;
    padding: 10px 25px;
    border-radius: 25px;
    font-weight: 600;
    margin-top: 10px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
}

.card-title {
    color: #333;
    margin-bottom: 20px;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-title::before {
    font-size: 1.5rem;
}

.info-grid {
    display: grid;
    gap: 15px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 10px;
    transition: all 0.3s ease;
}

.info-item:hover {
    background: #e9ecef;
}

.info-label {
    color: #666;
    font-weight: 600;
}

.info-value {
    color: #333;
    font-weight: 700;
    word-break: break-all;
    text-align: right;
    max-width: 60%;
}

.contract-info .card-title::before {
    content: "üìÑ";
}

.network-info .card-title::before {
    content: "üåê";
}

.account-info .card-title::before {
    content: "üë§";
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #f44336;
    margin-bottom: 10px;
}

.stat-label {
    color: #666;
    font-size: 1rem;
}

.controls {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.controls-title {
    color: #333;
    margin-bottom: 25px;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.controls-title::before {
    content: "‚öôÔ∏è";
}

.controls-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.control-btn {
    padding: 20px;
    border: none;
    border-radius: 15px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.control-btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

.control-btn:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

@keyframes ripple {
    0% { transform: scale(0, 0); opacity: 0.5; }
    100% { transform: scale(20, 20); opacity: 0; }
}

.primary-control {
    background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
    color: white;
}

.success-control {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    color: white;
}

.warning-control {
    background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
    color: white;
}

.danger-control {
    background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
    color: white;
}

.control-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.control-btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

.control-btn.loading::after {
    content: " ‚è≥";
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.results-container {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.results-title {
    color: #333;
    margin-bottom: 25px;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.results-title::before {
    content: "üìä";
}

.results-content {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 15px;
    min-height: 200px;
    border-left: 5px solid #4CAF50;
}

.candidate-result {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin-bottom: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
}

.candidate-name {
    font-size: 1.2rem;
    font-weight: 600;
    color: #333;
    display: flex;
    align-items: center;
    gap: 10px;
}

.vote-bar {
    flex-grow: 1;
    height: 20px;
    background: #e0e0e0;
    border-radius: 10px;
    margin: 0 20px;
    overflow: hidden;
    position: relative;
}

.vote-fill {
    height: 100%;
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    border-radius: 10px;
    transition: width 1s ease;
}

.vote-count {
    font-weight: 700;
    color: #333;
    min-width: 80px;
    text-align: right;
}

.status-container {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 40px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.status-title {
    color: #333;
    margin-bottom: 20px;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-title::before {
    content: "üì¢";
}

#statusMessage {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 15px;
    min-height: 100px;
    font-size: 1.1rem;
    line-height: 1.6;
    border-left: 5px solid #2196F3;
    transition: all 0.3s ease;
}

#statusMessage.success {
    background: #e8f5e8;
    border-left-color: #4CAF50;
}

#statusMessage.error {
    background: #ffebee;
    border-left-color: #f44336;
}

#statusMessage.warning {
    background: #fff3e0;
    border-left-color: #FF9800;
}

.action-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.action-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 200px;
}

.back-btn {
    background: linear-gradient(135deg, #9E9E9E 0%, #616161 100%);
    color: white;
}

.back-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.refresh-btn {
    background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
    color: white;
}

.refresh-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(33, 150, 243, 0.3);
}

.logout-btn {
    background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
    color: white;
}

.logout-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(244, 67, 54, 0.3);
}

.hidden {
    display: none;
}

@media (max-width: 768px) {
    .dashboard {
        grid-template-columns: 1fr;
    }
    
    .controls-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-btn {
        width: 100%;
    }
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>‚öôÔ∏è Admin Control Panel</h1>
        <p class="subtitle">Full control over the blockchain voting system</p>
        <div class="admin-badge">ADMIN PRIVILEGES</div>
    </div>
    
    <div class="dashboard">
        <div class="card contract-info">
            <h3 class="card-title">Contract Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Contract Address</span>
                    <span id="contractAddress" class="info-value">Loading...</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Admin Address</span>
                    <span id="adminAddress" class="info-value">Loading...</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Candidates</span>
                    <span id="totalCandidates" class="info-value">4</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Voting Status</span>
                    <span id="votingStatus" class="info-value">Active</span>
                </div>
            </div>
        </div>
        
        <div class="card network-info">
            <h3 class="card-title">Network Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Network</span>
                    <span id="networkName" class="info-value">Localhost 8545</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Chain ID</span>
                    <span id="chainId" class="info-value">31337</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Block Height</span>
                    <span id="blockHeight" class="info-value">Loading...</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Gas Price</span>
                    <span id="gasPrice" class="info-value">Loading...</span>
                </div>
            </div>
        </div>
        
        <div class="card account-info">
            <h3 class="card-title">Your Account</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Account Address</span>
                    <span id="accountAddress" class="info-value">Not connected</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Balance</span>
                    <span id="accountBalance" class="info-value">0 ETH</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Role</span>
                    <span id="accountRole" class="info-value">Unknown</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span id="accountStatus" class="info-value">Disconnected</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value" id="totalVotes">0</div>
            <div class="stat-label">Total Votes Cast</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="aliceVotes">0</div>
            <div class="stat-label">Akhil Krantikari</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="bobVotes">0</div>
            <div class="stat-label">ANNFSU</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="voterTurnout">0%</div>
            <div class="stat-label">Voter Turnout</div>
        </div>
    </div>
    
    <div class="controls">
        <h3 class="controls-title">Admin Controls</h3>
        <div class="controls-grid">
            <button class="control-btn primary-control" onclick="getVotingResults()">
                üìä Get Voting Results
            </button>
            <button class="control-btn success-control" onclick="addNewCandidate()">
                ‚ûï Add New Candidate
            </button>
            <button class="control-btn warning-control" onclick="endVotingSession()">
                ‚èπÔ∏è End Voting Session
            </button>
            <button class="control-btn danger-control" onclick="resetVoting()">
                üîÑ Reset Voting
            </button>
        </div>
    </div>
    
    <div class="results-container">
        <h3 class="results-title">Live Voting Results</h3>
        <div class="results-content" id="resultsContent">
            <div id="resultsPlaceholder">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Click "Get Voting Results" to view live voting statistics
                </p>
            </div>
            <div id="resultsDisplay" class="hidden">
                <!-- Results will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <div class="status-container">
        <h3 class="status-title">System Status</h3>
        <div id="statusMessage">
            üîó Admin panel loaded successfully
        </div>
    </div>
    
    <div class="action-buttons">
        <button class="action-btn back-btn" onclick="window.location.href='index.html'">
            ‚Üê Back to Home
        </button>
        <button class="action-btn refresh-btn" onclick="refreshAllData()">
            üîÑ Refresh All Data
        </button>
        <button class="action-btn logout-btn" onclick="logout()">
            üö™ Logout
        </button>
    </div>
</div>

<script>
// ========== ADMIN LOGIN CHECK ==========
window.addEventListener('load', function() {
    const isLoggedIn = sessionStorage.getItem('isLoggedIn');
    const walletConnected = sessionStorage.getItem('walletConnected');
    const account = sessionStorage.getItem('account');
    
    // Check if logged in
    if (!isLoggedIn || isLoggedIn !== 'true') {
        alert("‚ö†Ô∏è Please login first!");
        window.location.href = "login.html";
        return;
    }
    
    // Check if wallet connected
    if (!walletConnected || walletConnected !== 'true') {
        alert("‚ö†Ô∏è Please connect your wallet first!");
        window.location.href = "login.html";
        return;
    }
    
    // Check if account is admin (only account #0 can access admin)
    const ADMIN_ADDRESS = "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266";
    if (!account || account.toLowerCase() !== ADMIN_ADDRESS.toLowerCase()) {
        alert("‚ùå Admin Access Denied!\nOnly the admin account can access this panel.");
        window.location.href = "voting.html"; // Redirect to voting page instead
        return;
    }
    
    // Update UI with admin info
    const username = sessionStorage.getItem('username') || 'Admin';
    document.getElementById('accountAddress').textContent = formatAddress(account);
    document.getElementById('accountRole').textContent = "üëë Admin";
    document.getElementById('accountRole').style.color = "#f44336";
    document.getElementById('accountStatus').textContent = "Connected ‚úÖ";
    document.getElementById('accountStatus').style.color = "#4CAF50";
    
    console.log(`Welcome Admin ${username}!`);
});
// ========== END ADMIN LOGIN CHECK ==========

// Configuration
const CONFIG = {
    ADMIN_ADDRESS: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266",
    CONTRACT_ADDRESS: "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",
    NETWORK: {
        chainId: "0x7A69",
        chainName: "Hardhat Localhost"
    }
};

// State
let currentAccount = null;
let blockHeight = 0;
let gasPrice = "0";

// DOM Elements
const statusMessage = document.getElementById('statusMessage');
const contractAddress = document.getElementById('contractAddress');
const adminAddress = document.getElementById('adminAddress');
const totalCandidates = document.getElementById('totalCandidates');
const votingStatus = document.getElementById('votingStatus');
const networkName = document.getElementById('networkName');
const chainId = document.getElementById('chainId');
const blockHeightDisplay = document.getElementById('blockHeight');
const gasPriceDisplay = document.getElementById('gasPrice');
const accountAddress = document.getElementById('accountAddress');
const accountBalance = document.getElementById('accountBalance');
const accountRole = document.getElementById('accountRole');
const accountStatus = document.getElementById('accountStatus');
const totalVotes = document.getElementById('totalVotes');
const aliceVotes = document.getElementById('aliceVotes');
const bobVotes = document.getElementById('bobVotes');
const voterTurnout = document.getElementById('voterTurnout');
const resultsContent = document.getElementById('resultsContent');
const resultsPlaceholder = document.getElementById('resultsPlaceholder');
const resultsDisplay = document.getElementById('resultsDisplay');

// Format address
function formatAddress(address) {
    if (!address) return "Not connected";
    return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;
}

// Format balance
function formatBalance(balanceWei) {
    const balanceEth = parseInt(balanceWei) / 1e18;
    return `${balanceEth.toFixed(4)} ETH`;
}

// Format gas price
function formatGasPrice(gasPriceWei) {
    const gasPriceGwei = parseInt(gasPriceWei) / 1e9;
    return `${gasPriceGwei.toFixed(2)} Gwei`;
}

// Update status
function updateStatus(message, type = "info") {
    statusMessage.innerHTML = message;
    statusMessage.className = "";
    
    switch(type) {
        case "success":
            statusMessage.classList.add("success");
            break;
        case "error":
            statusMessage.classList.add("error");
            break;
        case "warning":
            statusMessage.classList.add("warning");
            break;
    }
}

// Get account from session storage
function getAccountFromStorage() {
    const account = sessionStorage.getItem('account');
    if (account && account.toLowerCase() === CONFIG.ADMIN_ADDRESS.toLowerCase()) {
        currentAccount = account;
        return true;
    }
    return false;
}

// Load admin data
async function loadAdminData() {
    if (!getAccountFromStorage()) {
        updateStatus("‚ùå Not logged in as admin", "error");
        return;
    }
    
    try {
        // Get account balance
        const balance = await window.ethereum.request({
            method: 'eth_getBalance',
            params: [currentAccount, 'latest']
        });
        
        // Get network info
        const block = await window.ethereum.request({
            method: 'eth_getBlockByNumber',
            params: ['latest', false]
        });
        
        const gasPriceData = await window.ethereum.request({
            method: 'eth_gasPrice',
            params: []
        });
        
        // Update state
        blockHeight = parseInt(block.number);
        gasPrice = gasPriceData;
        
        // Update UI
        updateAdminUI(balance);
        updateStatus(`‚úÖ Connected as ADMIN: ${formatAddress(currentAccount)}`, "success");
        
    } catch (error) {
        console.error("Admin data error:", error);
        updateStatus(`‚ùå Error loading admin data: ${error.message}`, "error");
    }
}

// Update admin UI
function updateAdminUI(balance) {
    // Contract info
    contractAddress.textContent = formatAddress(CONFIG.CONTRACT_ADDRESS);
    adminAddress.textContent = formatAddress(CONFIG.ADMIN_ADDRESS);
    totalCandidates.textContent = "4";
    votingStatus.textContent = "Active ‚úÖ";
    votingStatus.style.color = "#4CAF50";
    
    // Network info
    networkName.textContent = CONFIG.NETWORK.chainName;
    chainId.textContent = parseInt(CONFIG.NETWORK.chainId).toString();
    blockHeightDisplay.textContent = blockHeight;
    gasPriceDisplay.textContent = formatGasPrice(gasPrice);
    
    // Account info
    accountAddress.textContent = formatAddress(currentAccount);
    accountBalance.textContent = formatBalance(balance);
    accountRole.textContent = "üëë Admin";
    accountRole.style.color = "#f44336";
    accountStatus.textContent = "Connected ‚úÖ";
    accountStatus.style.color = "#4CAF50";
}

// Get voting results (demo data since contract doesn't have getVotes)
async function getVotingResults() {
    try {
        updateStatus("üìä Fetching voting results...", "warning");
        
        // Generate demo data (in real contract, you'd call getVotes)
        const candidates = [
            { name: "Akhil Krantikari", votes: Math.floor(Math.random() * 50) + 20, color: "#d32f2f", symbol: "üî¥" },
            { name: "ANNFSU", votes: Math.floor(Math.random() * 50) + 15, color: "#1976d2", symbol: "üîµ" },
            { name: "NSU", votes: Math.floor(Math.random() * 50) + 10, color: "#388e3c", symbol: "üü¢" },
            { name: "Independent", votes: Math.floor(Math.random() * 50) + 5, color: "#fbc02d", symbol: "üü°" }
        ];
        
        const totalVoteCount = candidates.reduce((sum, c) => sum + c.votes, 0);
        const turnout = Math.min(100, Math.floor((totalVoteCount / 100) * 100));
        const maxVotes = Math.max(...candidates.map(c => c.votes));
        
        // Update stats
        totalVotes.textContent = totalVoteCount;
        aliceVotes.textContent = candidates[0].votes;
        bobVotes.textContent = candidates[1].votes;
        voterTurnout.textContent = `${turnout}%`;
        
        // Update results display
        resultsPlaceholder.classList.add("hidden");
        resultsDisplay.classList.remove("hidden");
        
        let resultsHTML = '';
        candidates.forEach(candidate => {
            const percentage = maxVotes > 0 ? (candidate.votes / maxVotes) * 100 : 0;
            resultsHTML += `
                <div class="candidate-result">
                    <div class="candidate-name">${candidate.symbol} ${candidate.name}</div>
                    <div class="vote-bar">
                        <div class="vote-fill" style="width: ${percentage}%; background: ${candidate.color};"></div>
                    </div>
                    <div class="vote-count">${candidate.votes} votes</div>
                </div>
            `;
        });
        
        const leadingCandidate = candidates.reduce((prev, current) => 
            (prev.votes > current.votes) ? prev : current
        );
        
        resultsHTML += `
            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="font-weight: 600;">Total Votes:</span>
                    <span style="font-weight: 700;">${totalVoteCount}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="font-weight: 600;">Leading Candidate:</span>
                    <span style="font-weight: 700; color: ${leadingCandidate.color}">
                        ${leadingCandidate.symbol} ${leadingCandidate.name} üèÜ
                    </span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="font-weight: 600;">Voter Turnout:</span>
                    <span style="font-weight: 700;">${turnout}%</span>
                </div>
            </div>
        `;
        
        resultsDisplay.innerHTML = resultsHTML;
        updateStatus("‚úÖ Voting results loaded successfully!", "success");
        
    } catch (error) {
        updateStatus(`‚ùå Error fetching results: ${error.message}`, "error");
    }
}

// Add new candidate
async function addNewCandidate() {
    const candidateName = prompt("Enter the name of the new candidate:");
    if (!candidateName || candidateName.trim() === "") {
        alert("Candidate name cannot be empty!");
        return;
    }
    
    updateStatus(`üîÑ Adding candidate "${candidateName}"...`, "warning");
    
    // Simulate transaction (in real contract, you'd send transaction)
    setTimeout(() => {
        updateStatus(
            `‚úÖ Candidate "${candidateName}" added successfully!<br>
            <small>Note: Your contract needs an addCandidate function to actually add candidates.</small>`,
            "success"
        );
        
        // Update candidate count
        const currentCount = parseInt(totalCandidates.textContent);
        totalCandidates.textContent = (currentCount + 1).toString();
    }, 2000);
}

// End voting session
async function endVotingSession() {
    if (!confirm("‚ö†Ô∏è Are you sure you want to END the voting session?\n\nThis will stop all voting activities.")) {
        return;
    }
    
    updateStatus("üîÑ Ending voting session...", "warning");
    
    // Simulate transaction
    setTimeout(() => {
        votingStatus.textContent = "Ended ‚èπÔ∏è";
        votingStatus.style.color = "#f44336";
        
        updateStatus("‚úÖ Voting session ended successfully!", "success");
    }, 2000);
}

// Reset voting
async function resetVoting() {
    if (!confirm("üö®üö® DANGER üö®üö®\n\nAre you ABSOLUTELY SURE you want to RESET ALL VOTES?\n\nThis will DELETE ALL voting data and CANNOT be undone!")) {
        return;
    }
    
    updateStatus("üîÑ Resetting all votes...", "warning");
    
    // Simulate transaction
    setTimeout(() => {
        // Reset stats
        totalVotes.textContent = "0";
        aliceVotes.textContent = "0";
        bobVotes.textContent = "0";
        voterTurnout.textContent = "0%";
        
        // Reset results display
        resultsPlaceholder.classList.remove("hidden");
        resultsDisplay.classList.add("hidden");
        
        // Reset voting status
        votingStatus.textContent = "Active ‚úÖ";
        votingStatus.style.color = "#4CAF50";
        
        updateStatus("‚úÖ All votes have been reset! Voting is now open.", "success");
    }, 3000);
}

// Refresh all data
async function refreshAllData() {
    try {
        updateStatus("üîÑ Refreshing all data...", "warning");
        
        await loadAdminData();
        await getVotingResults();
        
        updateStatus("‚úÖ All data refreshed successfully!", "success");
        
    } catch (error) {
        updateStatus(`‚ùå Error refreshing data: ${error.message}`, "error");
    }
}

// Logout function
function logout() {
    if (confirm("Are you sure you want to logout?")) {
        // Clear all session storage
        sessionStorage.clear();
        
        // Show logout message
        updateStatus("üîí Logging out... Redirecting to login page.", "warning");
        
        // Redirect to login after delay
        setTimeout(() => {
            window.location.href = "login.html";
        }, 1000);
    }
}

// Initialize on page load
window.addEventListener('load', async () => {
    // Update contract address display
    contractAddress.textContent = formatAddress(CONFIG.CONTRACT_ADDRESS);
    adminAddress.textContent = formatAddress(CONFIG.ADMIN_ADDRESS);
    
    if (window.ethereum) {
        try {
            // Load admin data
            await loadAdminData();
            
            // Load initial results
            await getVotingResults();
            
        } catch (error) {
            console.log("Admin initialization error:", error);
        }
        
        // Listen for account changes
        window.ethereum.on('accountsChanged', (accounts) => {
            if (accounts && accounts.length > 0) {
                const account = accounts[0];
                if (account.toLowerCase() === CONFIG.ADMIN_ADDRESS.toLowerCase()) {
                    // Update session storage
                    sessionStorage.setItem('account', account);
                    location.reload();
                } else {
                    alert("‚ùå Switched to non-admin account. Redirecting to voting page.");
                    window.location.href = "voting.html";
                }
            } else {
                alert("üîå Disconnected from wallet. Please reconnect.");
                window.location.href = "login.html";
            }
        });
        
        // Listen for network changes
        window.ethereum.on('chainChanged', () => {
            window.location.reload();
        });
        
    } else {
        updateStatus(
            "‚ùå MetaMask not detected!<br>" +
            "Please install <a href='https://metamask.io/' target='_blank' style='color: #2196F3;'>MetaMask</a> to access admin panel.",
            "error"
        );
    }
});
</script>
</body>
</html>